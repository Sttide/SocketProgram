#### 前言

```markdown
做一个自己的日志记录系统，记录程序处理过程中遇到的错误。
所用的知识有：C语言与文件系统，字符串拼接，未知参数个数的函数，计算机时间，系统调用读写文件接口。
设计到的点零碎，每一个不懂得概念都需要去查找、学习、掌握，初学预计完全掌握需要4个小时学习成本。
```

## 日志系统

### 需求

```markdown
实现一个可以记录程序运行中关键信息的日志系统。
```

### 需求分析

```markdown
1.日志使用自己单独写一个文件保存
2.记录信息为字符串类型，包括记录当前时间
3.日志文件有大小限制，超过限制后自动覆盖最早的一条消息
```

### 概要设计

```markdown
1.文件设计
进程启动时，打开文件，文件描述符通过全局变量保存，使用系统调用函数open write，open直接对文件描述符进行操作
①如果文件存在，接下去写。
②如果文件不存在，创建文件。

2.记录信息
拼接字符串。将时间转换成字符串，将用户信息内容转换成字符串，拼接后写入文件中。
①时间。通过C标准库函数获取时间，并显示。
②信息内容。通过未知参数个数的函数支持用户传递字符串信息
```

### 详细设计

#### 文件设计

```markdown
1.正常打开一个文件写入。
2.大小限制。
  设置一个最大字节数。记录每次写入的字节数，当写入的字节数大于限制时，将文件指针移到文件最开始写入数据。
```

#### 拼接字符串

```c
C语言的格式化字符串
    可扩展性好，支持用户填入多个参数，支持用户打印变量值
    不确定参数的函数
    va_start
    va_arg
    va_end
    日志信息以字符串形式保存，提供一个宏和函数，支持变参传入。 
```

#### 时间获取并转换

```c
时间实现。
计算机计算时间的原理，保存有一个全局变量，这个变量存放一个数，每过一秒+1，日期的起始点是1970年1月1日8时0分0秒，这个数就是从起始点开始经过了多少秒，计算当前时间，就把这个数取出来，自己计算这个秒数是多少年多少月多少天，加上1970就是现在的时间。

标准C库实现（与平台无关的时间函数）
#include <time.h>
time_t time(NULL);  返回秒数, time_t 是long long类型，一个uint64的整数。

struct tm* localtime(time_t tt); 标准库提供的帮你计算时间的函数，不用你自己写了。
计算的结果存在结构体struct tm里面，结构体是下面这个。
struct tm {
    int tm_sec;  秒
    int tm_min;  分
    int tm_hour; 时
    int tm_mday; 当月几号
    int tm_mon;  月份，范围是0-11,0表示1月份，11表示12月份
    int tm_year; 年，注意，这个值是从1900年开始算的，tm_year + 1900表示当前年份
    int tm_wday; 星期几，范围0-6,0是星期天，1是星期一，6是星期六
    int tm_yday; 当年的第几天，1月1日是第0天
    int tm_isdst;是否是夏令时
};

linux提供了一个函数，可以把μs的时间带出来，同时把时区带出来
#include <sys/time.h>
int gettimeofday(struct timeval *tv, struct timezone *tx) 第一个参数时间，第二个参数时区
struct timeval{
    time_t tv_sec;      这个值和time()函数取出来的值是一样的
    suseconds_t tv_usec;   这个值表示微秒值
};
struct timezone{
    int tz_minuteswest;
    int tz_dsttime;
};

void gettimeofdat(tv, NULL); 第二个不用传空即可
```

